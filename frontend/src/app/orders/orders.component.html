<div class="container">
  <h2>Orders</h2>

  <!-- Filters -->
  <div class="filter-section">
    <label for="statusFilter">Filter by Status:</label>
    <select id="statusFilter" [(ngModel)]="selectedFilter" (change)="onFilterChange()">
      <option value="ALL">All</option>
      <option value="PENDING">Pending</option>
      <option value="EXECUTED">Executed</option>
      <option value="CANCELLED">Cancelled</option>
    </select>
    <span class="filter-info">Found: {{ filteredOrders.length }} orders</span>
  </div>

  <!-- Add Form -->
  <div class="form-section">
    <h3>Add New Order</h3>
    <form (ngSubmit)="addOrder()">
      <div class="form-row">
        <div class="form-group">
          <label for="userId">User:</label>
          <select id="userId" [(ngModel)]="newOrder.userId" name="userId" required>
            <option value="0">-- Select User --</option>
            <option *ngFor="let user of users" [value]="user.id">
              {{ user.firstName }} {{ user.lastName }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="companyId">Company:</label>
          <select id="companyId" [(ngModel)]="newOrder.companyId" name="companyId" required>
            <option value="0">-- Select Company --</option>
            <option *ngFor="let company of companies" [value]="company.id">
              {{ company.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="orderType">Order Type:</label>
          <select id="orderType" [(ngModel)]="newOrder.orderType" name="orderType" required>
            <option value="BUY">Buy</option>
            <option value="SELL">Sell</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="quantity">Quantity:</label>
          <input type="number" id="quantity" [(ngModel)]="newOrder.quantity" 
                 name="quantity" min="1" required>
        </div>

        <div class="form-group">
          <label for="price">Price:</label>
          <input type="number" id="price" [(ngModel)]="newOrder.price" 
                 name="price" min="0.01" step="0.01" required>
        </div>
      </div>

      <button type="submit">Add Order</button>
    </form>
  </div>

  <!-- Orders List -->
  <div class="orders-list">
    <h3>Orders List ({{ selectedFilter === 'ALL' ? 'All' : selectedFilter }})</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Company</th>
          <th>Type</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of filteredOrders">
          <td>{{ order.id }}</td>
          <td>{{ getUserName(order.userId) }}</td>
          <td>{{ getCompanyName(order.companyId) }}</td>
          <td>
            <span class="order-type" [class.buy]="order.orderType === 'BUY'" 
                  [class.sell]="order.orderType === 'SELL'">
              {{ order.orderType }}
            </span>
          </td>
          <td>{{ order.quantity }}</td>
          <td>{{ order.price | number:'1.2-2' }} PLN</td>
          <td>{{ order.orderDate | date:'dd.MM.yyyy HH:mm' }}</td>
          <td>
            <span class="status" [class.pending]="order.status === 'PENDING'"
                  [class.executed]="order.status === 'EXECUTED'"
                  [class.cancelled]="order.status === 'CANCELLED'">
              {{ order.status }}
            </span>
          </td>
          <td>
            <button class="cancel-btn" (click)="cancelOrder(order.id)" 
                    [disabled]="order.status === 'CANCELLED' || order.status === 'EXECUTED'">
              Cancel
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredOrders.length === 0" class="no-data">
      No orders to display
    </div>
  </div>
</div>
